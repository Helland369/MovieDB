<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/htmx.org@2.0.4"
    integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/index.css">
  <title>MovieDb</title>
</head>

  <body>
    <header>
      <nav id="nav-bar">
        <img id="logo" class="logo" src="image.jpg">
        <div id="menu">menu?</div>
        <input
          type="text"
          name="query"
          id="name"
          placeholder="Search"
          hx-get="/tmdb/search"
          hx-trigger="keyup changed delay:300ms"
          hx-target="#results"
          hx-swap="innerHTML"
          hx-indicator="#loading"
          autocomplete="off"/>
      </nav>
    </header>

    <main>
      <div id="loading" class="htmx-indicator" style="display:none">loading...</div>

      <div id="results"></div>

      <input type="hidden" id="next-page" value="2">

      <div
        id="load-more"
        hx-get="/tmdb/search"
        hx-trigger="revealed"
        hx-swap="beforeend"
        hx-target="#results"
        hx-vals='js:{"query": document.getElementById("name").value, "page": document.getElementById("next-page").value}'></div>

      <div hx-get="/tmdb/trending" hx-trigger="load"></div>

    </main>

    <footer>
      <p>something</p>
    </footer>
  </body>

<script>
  document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.elt.id === 'load-more') {
      let nextPage = document.getElementById('next-page');
      nextPage.value = parseInt(nextPage.value) + 1;
    }
  });
</script>

</html>
